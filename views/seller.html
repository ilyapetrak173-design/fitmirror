<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>FitMirror — для продавцов</title>
  <style>
    :root { --lavender: #B399D4; --teal: #2A9D8F; --offwhite: #FDF9F3; }
    body { font-family: Inter, sans-serif; background: var(--offwhite); padding: 24px; max-width: 600px; margin: 0 auto; }
    h1 { font-size: 28px; background: linear-gradient(90deg, var(--teal), var(--lavender)); -webkit-background-clip: text; color: transparent; }
    .form-card { background: white; border-radius: 32px; padding: 28px; box-shadow: 0 10px 40px rgba(179, 153, 212, 0.15); margin-bottom: 24px; }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; margin-bottom: 8px; font-weight: 600; }
    .input-group input, .input-group textarea { width: 100%; padding: 14px; border: 1px solid #e0e0e0; border-radius: 18px; }
    .file-upload { border: 2px dashed #e0e0e0; border-radius: 18px; padding: 20px; text-align: center; cursor: pointer; }
    .action-btn { width: 100%; padding: 16px; background: var(--teal); color: white; border: none; border-radius: 20px; font-weight: 700; cursor: pointer; }
    .result-card { display: none; background: white; border-radius: 28px; padding: 24px; margin-top: 20px; }
    .note { font-size: 13px; color: #777; margin-top: 10px; }
    footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; font-size:12px; text-align:center; }
  </style>
</head>
<body>
  <h1>FitMirror</h1>
  <div class="form-card">
    <div class="input-group">
      <label>Ваш email</label>
      <input type="email" id="sellerEmail" placeholder="seller@brand.ru" required>
    </div>

    <div class="input-group">
      <label>Фото товара спереди</label>
      <div class="file-upload" onclick="document.getElementById('photoFront').click()">
        Нажмите, чтобы выбрать фото
      </div>
      <input type="file" id="photoFront" accept="image/*" style="display:none;" required>
    </div>

    <div class="input-group">
      <label>Фото товара сзади</label>
      <div class="file-upload" onclick="document.getElementById('photoBack').click()">
        Нажмите, чтобы выбрать фото
      </div>
      <input type="file" id="photoBack" accept="image/*" style="display:none;" required>
    </div>

    <div class="input-group">
      <label>Таблица размеров</label>
      <textarea id="sizeTable" rows="4" placeholder='{"S": {"chest":84,"waist":66,"hips":90}, "M": {"chest":88,"waist":70,"hips":94}}'></textarea>
      <p class="note">Укажите обхваты груди, талии и бёдер для каждого размера (в см)</p>
    </div>

    <div class="input-group">
      <label>
        <input type="checkbox" id="agreement" required> 
        Я даю согласие на обработку персональных данных в соответствии с 
        <a href="/privacy" target="_blank">Политикой конфиденциальности</a>
      </label>
    </div>

    <button class="action-btn" onclick="submitProduct()">Получить виджет</button>
  </div>

  <div class="result-card" id="resultCard">
    <h3>✅ Ваш виджет готов!</h3>
    <input type="text" id="widgetLink" readonly style="width:100%; padding:10px; margin-top:10px;">
  </div>

  <footer>
    <a href="/public-offer" target="_blank">Публичная оферта</a> • 
    <a href="/privacy" target="_blank">Политика конфиденциальности</a> • 
    Контакт: [fitmirror@mail.ru]
    <div style="margin-top:10px; font-size:11px;">
      ИП: [Петрак Вероника Робертовна] | ИНН: [732593790581] 
    </div>
  </footer>

  <script>
    async function submitProduct() {
      if (!document.getElementById('agreement').checked) {
        alert('Подтвердите согласие на обработку данных');
        return;
      }
      const email = document.getElementById('sellerEmail').value;
      const photoFront = document.getElementById('photoFront').files[0];
      const photoBack = document.getElementById('photoBack').files[0];
      const sizeTable = document.getElementById('sizeTable').value;

      if (!email || !photoFront || !photoBack) {
        alert('Заполните все поля');
        return;
      }

      const formData = new FormData();
      formData.append('seller_email', email);
      formData.append('photo_front', photoFront);
      formData.append('photo_back', photoBack);
      if (sizeTable) formData.append('size_table', sizeTable);

      const res = await fetch('/api/items', { method: 'POST', body: formData });
      const data = await res.json();
      if (res.ok) {
        document.getElementById('widgetLink').value = data.widget_url;
        document.getElementById('resultCard').style.display = 'block';
      } else {
        alert('Ошибка: ' + (data.error || 'неизвестно'));
      }
    }
  </script>
</body>
</html>
